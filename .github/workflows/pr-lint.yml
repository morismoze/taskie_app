name: PR Lint and Validation

on:
  # On every pull request
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  # JOB 1: Check PR title (Conventional Commits)
  # Since we use squash merging, checking commit messages is not effective (commitlint)
  check-pr-title:
    name: Validate PR Title
    runs-on: ubuntu-latest
    steps:
      # PR to develop - check commit message
      - name: Verify Conventional Commits
        if: github.base_ref != 'main'
        uses: amannn/action-semantic-pull-request@v5
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # Allows types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
          validateSingleCommit: false

      # PR to main - strict title check ("Develop to main")
      - name: Verify Release Title
        if: github.base_ref == 'main'
        run: |
          TITLE="${{ github.event.pull_request.title }}"
          EXPECTED="Develop to main"

          if [ "$TITLE" != "$EXPECTED" ]; then
            echo "❌ ERROR: Merging to 'main' requires strict title."
            echo "Expected: '$EXPECTED'"
            echo "Received: '$TITLE'"
            exit 1
          else
            echo "✅ Title is valid for release."
          fi
